<?php

namespace Modules\Inventory\App\Repositories;
use Doctrine\ORM\EntityRepository;
use Modules\Inventory\App\Entities\Purchase;



/**
 * PurchaseItemRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PurchaseItemRepository extends EntityRepository
{

    public function returnCategoryWiseAmount(Purchase $purchase)
    {
        $qb = $this->createQueryBuilder('e');
        $qb->join('e.item', 'item');
        $qb->join('item.category', 'cat');
        $qb->select('SUM(e.quantity * e.price) AS amount','cat.id as category');
        $qb->where('e.purchase = :purchase')->setParameter('purchase', $purchase->getId());
        $qb->groupBy('cat.id');
        $categories = $qb->getQuery()->getArrayResult();
        return $categories;
    }

}
